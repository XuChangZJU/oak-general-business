<!-- index.wxml -->
<view class="container">
    <view class="search-bar">
        <t-search placeholder="搜索" shape="round" value="{{searchValue}}" bind:change="searchChange" bind:submit="searchConfirm" bind:clear="searchCancel" />
    </view>
    <block wx:if="{{ users && users.length > 0 }}">
        <block wx:for="{{users}}" wx:for-index="index" wx:for-item="item" wx:key="idx">
            <t-cell title="{{item.nickname}}">
                <t-image slot="left-icon" t-class="avatar" src="{{item.avatar}}" mode="aspectFit" shape="circle"></t-image>
                <view slot="description" class="description">
                    <text class="name">姓名: {{item.name  || '未设置'}}</text>
                    <text class="mobile">手机: {{item.mobile  || '未设置'}}</text>
                    <view class="relation">
                        <block wx:if="{{relations.length === 1}}">
                            <view slot="more">
                                <t-switch value="{{item.hasRelation[0]}}" bind:change="onChange" data-id="{{item.id}}" data-relation="{{relations[0]}}" data-index="{{index}}" />
                            </view>
                        </block>
                        <block wx:else>
                            <t-divider />
                            <view class="relation-content">
                                <block wx:for="{{relations}}" wx:key="idx" wx:for-index="index2" wx:for-item="relation">
                                    <view class="relation-item">
                                        <view>
                                            <text>{{t(entity + ':r.' + relation)}}</text>
                                        </view>
                                        <view>
                                            <t-switch value="{{item.hasRelation[index2]}}" bind:change="onChange" data-id="{{item.id}}" data-relation="{{relation}}" data-index="{{index}}" />
                                        </view>
                                    </view>
                                </block>
                            </view>
                        </block>
                    </view>
                </view>
            </t-cell>
        </block>
        <t-button-group class="btn-container">
            <t-button icon="search" theme="primary" style="margin: 16rpx" block size="large" bind:tap="goSearchUser" content="搜索人员" />
            <t-button theme="primary" style="margin: 16rpx" block size="large" bind:tap="confirm" disabled="{{!oakDirty}}" content="确定" />
        </t-button-group>
    </block>
    <block wx:else>
        <view class="btn-search">
            <t-button theme="primary" style="margin: 16rpx" size="medium" bind:tap="goSearchUser" content="搜索人员" />
        </view>
    </block>
</view>