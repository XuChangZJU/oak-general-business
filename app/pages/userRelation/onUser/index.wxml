<!-- index.wxml -->
<view class="container">
    <view class="search-bar">
        <t-search style="width: 100%; margin: auto 0rpx" placeholder="搜索" shape="round" value="{{searchValue}}" bind:change="searchChange" bind:submit="searchConfirm" bind:clear="searchCancel" />
    </view>
    <block wx:if="{{ users && users.length > 0 }}">
        <block wx:for="{{users}}" wx:for-index="index" wx:for-item="item" wx:key="idx">
            <l-card l-class="card-view" title="{{item.name}}" describe="{{item.nickname}}" data-id="{{item.id}}" bind:tap="handleCardClick" type="avatar" image="{{item.avatar}}">
                <block wx:if="{{relations.length === 1}}">
                    <view slot="more">
                        <t-switch value="{{item.hasRelation[0]}}" bind:change="onChange" data-id="{{item.id}}" data-relation="{{relations[0]}}" data-index="{{index}}" />
                    </view>
                </block>
                <block wx:else>
                    <divider />
                    <view class="content">
                        <block wx:for="{{relations}}" wx:key="idx" wx:for-index="index2" wx:for-item="relation">
                            <view class="relation-item">
                                <text>{{relation}}</text>
                                <t-switch checked="{{item.hasRelation[index2]}}" bind:linchange="onChange" data-id="{{item.id}}" data-relation="{{relation}}" data-index="{{index}}" />
                            </view>
                        </block>
                    </view>
                </block>
            </l-card>
        </block>
        <view class="btn-container">
            <l-button icon="research" size="long" class="btn" icon-size="20" icon-color="#fff" bind:lintap="goSearchUser">
                搜索人员
            </l-button>
            <l-button type="success" size="long" class="btn" bind:lintap="confirm" disabled="{{!oakDirty}}">
                确定
            </l-button>
            <!-- <t-button icon="research" icon-props="{{ color: '#fff', size: '20' }}" theme="primary" style="margin: 16rpx" block size="large" bind:tap="goSearchUser" content="搜索人员" />
            <t-button theme="primary" style="margin: 16rpx" block size="large" bind:tap="confirm" disabled="{{!oakDirty}}" content="确定" /> -->
        </view>
    </block>
    <block wx:else>
        <view class="btn-search">
            <t-button theme="primary" style="margin: 16rpx" block size="medium" bind:tap="goSearchUser" content="搜索人员" />
        </view>
    </block>
</view>